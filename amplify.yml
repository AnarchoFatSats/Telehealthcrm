version: 1
applications:
  - appRoot: apps/web
    frontend:
      runtime-versions:
        nodejs: 20
      phases:
        preBuild:
          commands:
            - npm install --no-audit --no-fund
        build:
          commands:
            - "npm run build:check"
            - echo "âœ… Build security check passed"
        postBuild:
          commands:
            - echo "ðŸš€ Production build completed successfully"
            - echo "ðŸ“Š Build details:"
            - echo "  - Environment: ${NODE_ENV}"
            - echo "  - Build ID: ${AWS_AMPLIFY_BUILD_ID}"
            - echo "  - Branch: ${AWS_BRANCH}"
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
          - .next/cache/**/*
  - appRoot: apps/api
    backend:
      runtime-versions:
        nodejs: 20
      phases:
        preBuild:
          commands:
            - npm install --no-audit --no-fund
        build:
          commands:
            - npm run build
            - npm test
            - echo "âœ… API build and tests passed"
      artifacts:
        baseDirectory: dist
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*

testSettings:
  testReporting: true
  testType: unit
  testPath: apps/web/tests
  testCommand: npx playwright test --reporter=junit
